import { test, describe, expect } from "../fixtures";
import * as checkoutLocators from "../locators/checkout.locator";

describe("Checkout - detects existing account for logon", () => {

    test.beforeEach(async ({simpleProductPage}) => {
        await simpleProductPage.navigateTo();
        await simpleProductPage.addToCart();
    });

    test("Check existing email triggers logon prompt", async ({ checkoutPage, page  }) => {
        await checkoutPage.navigateTo();
        await page.locator('#checkout-link-button').click();
        await page.waitForSelector(checkoutLocators.email_field);
        await page.locator(checkoutLocators.email_field).isVisible();
        await page.locator(checkoutLocators.email_field).fill('lucas@vanstaden.com.au');
        const response = await page.waitForResponse(response => response.url().includes('/rest/default/V1/customers/isEmailAvailable'));
        expect(response.status()).toBe(200);
        const responseBody =  await response.text();
    });

});
